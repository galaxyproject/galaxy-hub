---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PageHeader from '../../components/layout/PageHeader.astro';
import NewsList from '../../components/news/NewsList.vue';
import { getPublishedNews } from '../../utils/content';
import { normalizeSlug } from '../../utils/slug';

// Get published news articles (excludes future-dated articles)
const newsArticles = await getPublishedNews();

// Transform to plain objects for Vue component
const articleData = newsArticles.map((a) => ({
  slug: normalizeSlug(a.data.slug),
  title: a.data.title || 'Untitled',
  date: a.data.date instanceof Date ? a.data.date.toISOString() : a.data.date,
  tease: a.data.tease,
  tags: Array.isArray(a.data.tags) ? a.data.tags : a.data.tags ? [a.data.tags] : [],
  subsites: a.data.subsites,
}));
---

<BaseLayout title="News" description="Latest news from the Galaxy Project">
  <div class="max-w-6xl mx-auto">
    <PageHeader title="News" description="Latest updates from the Galaxy Project community" />

    <div class="bg-white px-6 sm:px-8 py-6 rounded-b-lg shadow-sm">
      <NewsList client:load articles={articleData} />
    </div>
  </div>
</BaseLayout>
