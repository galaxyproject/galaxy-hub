---
/**
 * Bare EU Events Page
 * Shows EU-filtered events in a table layout (8.2k visits)
 * Embedded in Galaxy EU interface
 */
import { getCollection } from 'astro:content';
import BareArticleLayout from '../../../layouts/BareArticleLayout.astro';
import EventsTable from '../../../components/bare/EventsTable.astro';
import Insert from '../../../components/Insert.astro';

const now = new Date();
const twelveMonthsAgo = new Date(now);
twelveMonthsAgo.setFullYear(twelveMonthsAgo.getFullYear() - 1);

const allEvents = await getCollection('events', (entry) => {
  const subsites = entry.data.subsites || [];
  return (
    (subsites.includes('eu') ||
      subsites.includes('all') ||
      subsites.includes('all-eu') ||
      subsites.includes('global') ||
      subsites.length === 0) &&
    !entry.data.draft
  );
});

const upcomingEvents = allEvents
  .filter((e) => {
    const endDate = e.data.end ? new Date(e.data.end) : e.data.date ? new Date(e.data.date) : null;
    return endDate && endDate >= now;
  })
  .sort((a, b) => {
    const dateA = a.data.date ? new Date(a.data.date) : new Date(0);
    const dateB = b.data.date ? new Date(b.data.date) : new Date(0);
    return dateA.getTime() - dateB.getTime();
  });

const pastEvents = allEvents
  .filter((e) => {
    const endDate = e.data.end ? new Date(e.data.end) : e.data.date ? new Date(e.data.date) : null;
    return endDate && endDate < now && endDate >= twelveMonthsAgo;
  })
  .sort((a, b) => {
    const dateA = a.data.date ? new Date(a.data.date) : new Date(0);
    const dateB = b.data.date ? new Date(b.data.date) : new Date(0);
    return dateB.getTime() - dateA.getTime();
  });
---

<BareArticleLayout title="Galaxy Europe Events">
  <Insert name="/eu/events/main" />

  {
    upcomingEvents.length > 0 && (
      <section>
        <h3>Upcoming Events</h3>
        <EventsTable events={upcomingEvents} />
      </section>
    )
  }

  {
    pastEvents.length > 0 && (
      <section>
        <h3>Recent Events (past 12 months)</h3>
        <EventsTable events={pastEvents} />
      </section>
    )
  }

  <style>
    h3 {
      color: #2c3143;
      border-bottom: 2px solid #25537b;
      padding-bottom: 0.5rem;
    }

    section {
      margin-bottom: 2rem;
    }
  </style>
</BareArticleLayout>
