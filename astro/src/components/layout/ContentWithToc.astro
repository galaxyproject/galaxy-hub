---
/**
 * ContentWithToc - Wraps article content with optional Table of Contents
 *
 * Handles both mobile (collapsible) and desktop (sidebar) TOC display.
 * Use this component to avoid duplicating TOC logic across page templates.
 */
import TableOfContents from './TableOfContents.astro';

interface Heading {
  depth: number;
  slug: string;
  text: string;
}

interface Props {
  headings?: Heading[];
  autotoc?: boolean;
}

const { headings = [], autotoc = false } = Astro.props;

// Determine if TOC should be shown (autotoc enabled and enough headings)
const filteredHeadings = headings.filter((h) => h.depth >= 2 && h.depth <= 4);
const showToc = autotoc && filteredHeadings.length >= 2;
---

{/* Mobile TOC: collapsible details element */}
{
  showToc && (
    <details class="toc-mobile lg:hidden mx-6 sm:mx-8 mt-6 border border-gray-200 rounded-lg">
      <summary class="px-4 py-3 cursor-pointer font-medium text-galaxy-primary hover:bg-gray-50 rounded-lg">
        On this page
      </summary>
      <div class="px-4 pb-4">
        <TableOfContents headings={headings} />
      </div>
    </details>
  )
}

{/* Content with optional TOC sidebar */}
<div class:list={['px-6 sm:px-8 pt-6', showToc && 'lg:flex lg:gap-8']}>
  {/* Main Content */}
  <div class:list={['prose prose-lg prose-galaxy max-w-none', showToc && 'lg:flex-1 lg:min-w-0']}>
    <slot />
  </div>

  {/* Desktop TOC Sidebar (right side) */}
  {
    showToc && (
      <aside class="toc-sidebar hidden lg:block lg:w-56 lg:flex-shrink-0">
        <div class="sticky top-24">
          <TableOfContents headings={headings} />
        </div>
      </aside>
    )
  }
</div>
