---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { Button } from '@/components/ui/button';
import { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/card';

// Get recent events (upcoming and recent)
const events = await getCollection('events');
const now = new Date();
const upcomingEvents = events
	.filter(e => {
		const eventDate = e.data.date instanceof Date ? e.data.date : new Date(e.data.date || '');
		return eventDate >= now;
	})
	.sort((a, b) => {
		const dateA = a.data.date instanceof Date ? a.data.date : new Date(a.data.date || '');
		const dateB = b.data.date instanceof Date ? b.data.date : new Date(b.data.date || '');
		return dateA.getTime() - dateB.getTime();
	})
	.slice(0, 4);

// Callout data from original content
const callouts = [
	{
		title: "Galaxy is a world-wide community",
		content: "There are over 500,000 registered Galaxy users from all over the world. Join this lively community to get help, contribute, and learn.",
		link: "/community/",
		linkText: "Explore the community",
		icon: "users"
	},
	{
		title: "Galaxy has 1,000s of tools",
		content: "In partnership with BioConda and BioContainers, Galaxy provides instant access to a vast number of analysis tools.",
		link: "/toolshed/",
		linkText: "Browse available tools",
		icon: "tools"
	},
	{
		title: "Galaxy = workflows",
		content: "Create complex workflows and deploy them via the UI or CLI. Share and publish reproducible analyses.",
		link: "https://training.galaxyproject.org/training-material/topics/galaxy-interface/tutorials/workflow-editor/tutorial.html",
		linkText: "Learn about workflows",
		icon: "workflow"
	},
	{
		title: "Leverage HPC and Clouds",
		content: "Distribute different types of computational jobs across any infrastructure using Pulsar and TPV.",
		link: "/admin/",
		linkText: "Admin documentation",
		icon: "cloud"
	},
	{
		title: "Put your tools before 1,000s of users",
		content: "Planemo, Galaxy's SDK, automates creation, testing, and deployment of tools, workflows, and interactive tutorials.",
		link: "https://planemo.readthedocs.org/",
		linkText: "Get started with Planemo",
		icon: "code"
	},
	{
		title: "Galaxy makes learning accessible",
		content: "Galaxy Training Network has 100s of community-vetted, hands-on tutorials on a variety of topics.",
		link: "https://training.galaxyproject.org/",
		linkText: "Start learning",
		icon: "learn"
	}
];

function formatDate(date: Date | string | undefined): string {
	if (!date) return '';
	const d = date instanceof Date ? date : new Date(date);
	return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
}
---

<BaseLayout title="Galaxy Community Hub" description="The Galaxy Community Hub - resources for the Galaxy Project community">
	<!-- Hero Section -->
	<section class="relative bg-gradient-to-br from-galaxy-primary via-galaxy-dark to-galaxy-primary text-white py-20">
		<div class="max-w-7xl mx-auto px-4 text-center">
			<h1 class="text-4xl md:text-6xl font-bold mb-6">
				Meet Galaxy<br/>
				<span class="text-galaxy-accent">Your companion in data analysis</span>
			</h1>
			<p class="text-xl md:text-2xl text-white/90 mb-8 max-w-3xl mx-auto">
				Open source platform for accessible, reproducible, and transparent computational research.
			</p>
			<div class="flex flex-wrap justify-center gap-4">
				<a
					href="https://usegalaxy.org/"
					target="_blank"
					rel="noopener noreferrer"
					class="inline-flex items-center px-8 py-3 bg-galaxy-accent hover:bg-green-400 text-galaxy-dark font-semibold rounded-lg transition-colors"
				>
					Use Galaxy Now
				</a>
				<a
					href="/get-started/"
					class="inline-flex items-center px-8 py-3 bg-white/10 hover:bg-white/20 text-white border border-white/30 font-semibold rounded-lg transition-colors"
				>
					Learn More
				</a>
			</div>
		</div>
	</section>

	<!-- Galaxy is more than you think -->
	<section class="py-16 bg-gray-50">
		<div class="max-w-7xl mx-auto px-4">
			<h2 class="text-3xl font-bold text-galaxy-dark text-center mb-12">
				Galaxy is more than you think
			</h2>
			<div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
				{callouts.map((callout) => (
					<Card client:load class="h-full hover:shadow-lg transition-shadow border-t-4 border-t-galaxy-primary">
						<CardHeader>
							<CardTitle class="text-lg text-galaxy-dark">{callout.title}</CardTitle>
						</CardHeader>
						<CardContent>
							<p class="text-gray-600 mb-4">{callout.content}</p>
							<a
								href={callout.link}
								class="text-galaxy-primary hover:text-galaxy-dark font-medium inline-flex items-center"
							>
								{callout.linkText}
								<svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
								</svg>
							</a>
						</CardContent>
					</Card>
				))}
			</div>
		</div>
	</section>

	<!-- Quick Links Section -->
	<section class="py-16">
		<div class="max-w-7xl mx-auto px-4">
			<div class="grid gap-8 md:grid-cols-2 lg:grid-cols-4">
				<a href="/events/" class="group block p-6 bg-white rounded-xl shadow-sm hover:shadow-md transition-all border border-gray-100">
					<div class="w-12 h-12 bg-galaxy-primary/10 rounded-lg flex items-center justify-center mb-4 group-hover:bg-galaxy-primary/20 transition-colors">
						<svg class="w-6 h-6 text-galaxy-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
						</svg>
					</div>
					<h3 class="font-semibold text-galaxy-dark mb-2">Events</h3>
					<p class="text-sm text-gray-600">Conferences, workshops, and community gatherings</p>
				</a>

				<a href="/use/" class="group block p-6 bg-white rounded-xl shadow-sm hover:shadow-md transition-all border border-gray-100">
					<div class="w-12 h-12 bg-galaxy-primary/10 rounded-lg flex items-center justify-center mb-4 group-hover:bg-galaxy-primary/20 transition-colors">
						<svg class="w-6 h-6 text-galaxy-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2"></path>
						</svg>
					</div>
					<h3 class="font-semibold text-galaxy-dark mb-2">Galaxy Platforms</h3>
					<p class="text-sm text-gray-600">Public servers and cloud deployments</p>
				</a>

				<a href="/community/" class="group block p-6 bg-white rounded-xl shadow-sm hover:shadow-md transition-all border border-gray-100">
					<div class="w-12 h-12 bg-galaxy-primary/10 rounded-lg flex items-center justify-center mb-4 group-hover:bg-galaxy-primary/20 transition-colors">
						<svg class="w-6 h-6 text-galaxy-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
						</svg>
					</div>
					<h3 class="font-semibold text-galaxy-dark mb-2">Community</h3>
					<p class="text-sm text-gray-600">Connect with the global Galaxy community</p>
				</a>

				<a href="https://training.galaxyproject.org/" target="_blank" rel="noopener noreferrer" class="group block p-6 bg-white rounded-xl shadow-sm hover:shadow-md transition-all border border-gray-100">
					<div class="w-12 h-12 bg-galaxy-primary/10 rounded-lg flex items-center justify-center mb-4 group-hover:bg-galaxy-primary/20 transition-colors">
						<svg class="w-6 h-6 text-galaxy-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
						</svg>
					</div>
					<h3 class="font-semibold text-galaxy-dark mb-2">Training</h3>
					<p class="text-sm text-gray-600">Learn Galaxy with GTN tutorials</p>
				</a>
			</div>
		</div>
	</section>

	<!-- Upcoming Events -->
	{upcomingEvents.length > 0 && (
		<section class="py-16 bg-gray-50">
			<div class="max-w-7xl mx-auto px-4">
				<div class="flex justify-between items-center mb-8">
					<h2 class="text-2xl font-bold text-galaxy-dark">Upcoming Events</h2>
					<a href="/events/" class="text-galaxy-primary hover:text-galaxy-dark font-medium inline-flex items-center">
						View all events
						<svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
						</svg>
					</a>
				</div>
				<div class="grid gap-6 md:grid-cols-2 lg:grid-cols-4">
					{upcomingEvents.map((event) => (
						<a
							href={`/events/${event.data.slug}/`}
							class="block bg-white rounded-lg p-5 shadow-sm hover:shadow-md transition-shadow border border-gray-100"
						>
							<div class="text-sm text-galaxy-primary font-medium mb-2">
								{formatDate(event.data.date)}
							</div>
							<h3 class="font-semibold text-galaxy-dark mb-2 line-clamp-2">
								{event.data.title}
							</h3>
							{event.data.location && (
								<p class="text-sm text-gray-500">{event.data.location}</p>
							)}
						</a>
					))}
				</div>
			</div>
		</section>
	)}

	<!-- Statistics / Social Proof -->
	<section class="py-16 bg-galaxy-dark text-white">
		<div class="max-w-7xl mx-auto px-4">
			<div class="grid gap-8 md:grid-cols-4 text-center">
				<div>
					<div class="text-4xl font-bold text-galaxy-accent mb-2">500K+</div>
					<div class="text-white/80">Registered Users</div>
				</div>
				<div>
					<div class="text-4xl font-bold text-galaxy-accent mb-2">1000+</div>
					<div class="text-white/80">Analysis Tools</div>
				</div>
				<div>
					<div class="text-4xl font-bold text-galaxy-accent mb-2">200+</div>
					<div class="text-white/80">Training Tutorials</div>
				</div>
				<div>
					<div class="text-4xl font-bold text-galaxy-accent mb-2">20+</div>
					<div class="text-white/80">Public Servers</div>
				</div>
			</div>
		</div>
	</section>

	<!-- Get Started CTA -->
	<section class="py-16">
		<div class="max-w-4xl mx-auto px-4 text-center">
			<h2 class="text-3xl font-bold text-galaxy-dark mb-4">Ready to get started?</h2>
			<p class="text-xl text-gray-600 mb-8">
				Galaxy is free to use and available at several public servers around the world.
			</p>
			<div class="flex flex-wrap justify-center gap-4">
				<a
					href="https://usegalaxy.org/"
					target="_blank"
					rel="noopener noreferrer"
					class="inline-flex items-center px-8 py-3 bg-galaxy-primary hover:bg-galaxy-dark text-white font-semibold rounded-lg transition-colors"
				>
					Use Galaxy
				</a>
				<a
					href="/support/"
					class="inline-flex items-center px-8 py-3 bg-gray-100 hover:bg-gray-200 text-galaxy-dark font-semibold rounded-lg transition-colors"
				>
					Get Support
				</a>
			</div>
		</div>
	</section>
</BaseLayout>
